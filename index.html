<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgraded Flappy Bird</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
    <style>
        body {
            overflow: hidden;
            touch-action: manipulation;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background-color: #70c5ce;
            transition: background-color 2s;
        }
        .night-mode {
            background-color: #2c3e50 !important;
        }
        #game-container {
            position: relative;
        }
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            color: white;
        }
        #character-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .character-option {
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        .character-option:hover, .character-option.selected {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .character-option img {
            width: 50px;
            height: 50px;
        }
        #achievement-popup {
            position: absolute;
            top: 20px;
            right: -300px;
            width: 250px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            transition: right 0.5s ease-in-out;
            z-index: 50;
        }
        #power-up-container {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 10px;
        }
        .power-up-icon {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            opacity: 0.5;
        }
        .power-up-active {
            opacity: 1;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        #settings-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 20;
        }
        #settings-panel {
            position: absolute;
            top: 50px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            padding: 15px;
            width: 200px;
            display: none;
            z-index: 20;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body class="bg-blue-100">
    <div class="flex flex-col items-center justify-center min-h-screen p-4">
        <h1 class="text-3xl font-bold mb-4 text-center text-blue-700">Upgraded Flappy Bird</h1>
        
        <div id="game-container" class="relative">
            <canvas id="game-canvas" width="320" height="480" class="border-4 border-blue-700 rounded-lg shadow-lg"></canvas>
            
            <div id="overlay" class="text-center">
                <h2 class="text-4xl font-bold mb-6">Flappy Adventure</h2>
                <p class="text-xl mb-6">Choose your character:</p>
                
                <div id="character-selection">
                    <div class="character-option selected" data-character="bird">
                        <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-dove text-white text-2xl"></i>
                        </div>
                        <p class="mt-2">Classic</p>
                    </div>
                    <div class="character-option" data-character="rocket">
                        <div class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-rocket text-white text-2xl"></i>
                        </div>
                        <p class="mt-2">Rocket</p>
                    </div>
                    <div class="character-option" data-character="ghost">
                        <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-ghost text-white text-2xl"></i>
                        </div>
                        <p class="mt-2">Ghost</p>
                    </div>
                </div>
                
                <button id="start-btn" class="mt-8 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full text-xl transition-all hover:scale-105">
                    Start Game
                </button>
                <p class="mt-6 text-sm">Press SPACE or tap to flap!</p>
            </div>
            
            <div id="power-up-container">
                <div class="power-up-icon bg-yellow-500" id="shield-power" title="Shield">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="power-up-icon bg-blue-500" id="slow-power" title="Slow Time">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="power-up-icon bg-purple-500" id="ghost-power" title="Phase Through">
                    <i class="fas fa-ghost"></i>
                </div>
            </div>
            
            <div id="achievement-popup">
                <h3 class="font-bold text-yellow-300"><i class="fas fa-trophy mr-2"></i>Achievement Unlocked!</h3>
                <p id="achievement-text" class="text-sm mt-1">First Flight: Complete your first game.</p>
            </div>
            
            <button id="settings-btn"><i class="fas fa-cog"></i></button>
            <div id="settings-panel">
                <h3 class="font-bold mb-3">Settings</h3>
                <div class="flex justify-between items-center mb-2">
                    <span>Sound</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span>Day/Night Cycle</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="day-night-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span>Difficulty</span>
                    <select id="difficulty" class="bg-gray-800 text-white rounded px-2 py-1">
                        <option value="easy">Easy</option>
                        <option value="normal" selected>Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game configuration
        const config = {
            gravity: 0.25,
            jumpForce: -4.6,
            pipeSpeed: 2,
            pipeGap: 85,
            pipeFrequency: 120,
            groundHeight: 112,
            characterType: 'bird',
            soundEnabled: true,
            dayNightCycleEnabled: true,
            difficulty: 'normal',
            powerUpFrequency: 0.05 // 5% chance to spawn a power-up
        };

        // Game state
        const state = {
            current: 0, // 0: menu, 1: game, 2: game over
            frames: 0,
            score: 0,
            bestScore: localStorage.getItem('flappyBestScore') || 0,
            dayNightCycle: 0, // 0-100, represents day-night transition
            dayDirection: 1, // 1: going to night, -1: going to day
            powerUps: {
                shield: { active: false, duration: 0, maxDuration: 200 },
                slowTime: { active: false, duration: 0, maxDuration: 300 },
                phaseThrough: { active: false, duration: 0, maxDuration: 150 }
            },
            achievements: {
                firstFlight: { earned: false, description: "First Flight: Complete your first game." },
                tenPoints: { earned: false, description: "Getting Started: Score 10 points." },
                twentyFivePoints: { earned: false, description: "Flappy Pro: Score 25 points." },
                fiftyPoints: { earned: false, description: "Master Flapper: Score 50 points." },
                useShield: { earned: false, description: "Protected: Use the shield power-up." },
                useSlowTime: { earned: false, description: "Time Lord: Use the slow time power-up." },
                usePhaseThrough: { earned: false, description: "Ghostly: Use the phase through power-up." }
            }
        };

        // DOM elements
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('start-btn');
        const characterOptions = document.querySelectorAll('.character-option');
        const achievementPopup = document.getElementById('achievement-popup');
        const achievementText = document.getElementById('achievement-text');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const soundToggle = document.getElementById('sound-toggle');
        const dayNightToggle = document.getElementById('day-night-toggle');
        const difficultySelect = document.getElementById('difficulty');
        const powerUpElements = {
            shield: document.getElementById('shield-power'),
            slow: document.getElementById('slow-power'),
            ghost: document.getElementById('ghost-power')
        };

        // Game objects
        const bird = {
            x: 50,
            y: 150,
            width: 34,
            height: 24,
            radius: 12,
            frame: 0,
            speed: 0,
            rotation: 0,
            animationSpeed: 5,
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // Draw based on character type
                ctx.fillStyle = this.getColor();
                ctx.beginPath();
                
                if (config.characterType === 'bird') {
                    // Bird shape
                    ctx.arc(0, 0, this.radius, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Add wing
                    ctx.fillStyle = "#FFFFFF";
                    ctx.beginPath();
                    if (this.frame === 0) {
                        ctx.ellipse(-5, 5, 10, 6, Math.PI / 4, 0, Math.PI * 2);
                    } else {
                        ctx.ellipse(-5, 0, 10, 6, 0, 0, Math.PI * 2);
                    }
                    ctx.fill();
                    
                    // Add eye
                    ctx.fillStyle = "#000000";
                    ctx.beginPath();
                    ctx.arc(5, -3, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Add beak
                    ctx.fillStyle = "#FF8800";
                    ctx.beginPath();
                    ctx.moveTo(10, 0);
                    ctx.lineTo(20, -5);
                    ctx.lineTo(20, 5);
                    ctx.closePath();
                    ctx.fill();
                } else if (config.characterType === 'rocket') {
                    // Rocket shape
                    ctx.fillStyle = "#FF4444";
                    ctx.beginPath();
                    ctx.moveTo(15, 0);
                    ctx.lineTo(-10, -10);
                    ctx.lineTo(-15, 0);
                    ctx.lineTo(-10, 10);
                    ctx.closePath();
                    ctx.fill();
                    
                    // Window
                    ctx.fillStyle = "#88CCFF";
                    ctx.beginPath();
                    ctx.arc(0, 0, 6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Flames
                    ctx.fillStyle = this.frame === 0 ? "#FFAA00" : "#FF6600";
                    ctx.beginPath();
                    ctx.moveTo(-15, -3);
                    ctx.lineTo(-25, 0);
                    ctx.lineTo(-15, 3);
                    ctx.closePath();
                    ctx.fill();
                } else if (config.characterType === 'ghost') {
                    // Ghost shape
                    ctx.fillStyle = "#BBAACC";
                    ctx.globalAlpha = 0.8;
                    ctx.beginPath();
                    ctx.arc(0, -5, this.radius, 0, Math.PI, true);
                    ctx.lineTo(-this.radius, 5);
                    ctx.lineTo(-this.radius + 4, 2);
                    ctx.lineTo(-this.radius + 8, 5);
                    ctx.lineTo(-this.radius + 12, 2);
                    ctx.lineTo(-this.radius + 16, 5);
                    ctx.lineTo(this.radius, 5);
                    ctx.closePath();
                    ctx.fill();
                    
                    // Eyes
                    ctx.fillStyle = "#FFFFFF";
                    ctx.globalAlpha = 1;
                    ctx.beginPath();
                    ctx.arc(-4, -7, 4, 0, Math.PI * 2);
                    ctx.arc(4, -7, 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = "#000000";
                    ctx.beginPath();
                    ctx.arc(-2, -7, 2, 0, Math.PI * 2);
                    ctx.arc(6, -7, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Draw power-up effects
                if (state.powerUps.shield.active) {
                    ctx.strokeStyle = "#FFD700";
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.radius + 5, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                if (state.powerUps.phaseThrough.active) {
                    ctx.globalAlpha = 0.5;
                }
                
                ctx.restore();
            },
            getColor() {
                switch (config.characterType) {
                    case 'bird': return "#FFDD00";
                    case 'rocket': return "#FF0000";
                    case 'ghost': return "#BBAACC";
                    default: return "#FFDD00";
                }
            },
            update() {
                // Bird animation speed
                if (state.frames % this.animationSpeed === 0) {
                    this.frame = this.frame === 0 ? 1 : 0;
                }
                
                // Apply gravity if game is active
                if (state.current === 1) {
                    // Apply modified gravity based on slow time power-up
                    const gravityModifier = state.powerUps.slowTime.active ? 0.5 : 1;
                    this.speed += config.gravity * gravityModifier;
                    this.y += this.speed;
                    
                    // Rotation based on speed
                    if (this.speed < 0) {
                        this.rotation = -0.3;
                    } else {
                        this.rotation = Math.min(Math.PI/2, this.speed * 0.05);
                    }
                    
                    // Ground collision
                    if (this.y + this.radius >= canvas.height - config.groundHeight) {
                        this.y = canvas.height - config.groundHeight - this.radius;
                        if (state.current === 1) {
                            state.current = 2; // Game over
                            playSound('hit');
                        }
                    }
                    
                    // Ceiling collision
                    if (this.y - this.radius <= 0) {
                        this.y = this.radius;
                        this.speed = 0;
                    }
                } else {
                    // Bird hover animation in menu and game over states
                    this.y = 150 + Math.sin(state.frames / 10) * 8;
                    this.rotation = 0;
                }
            },
            flap() {
                if (state.current === 1) {
                    this.speed = config.jumpForce;
                    playSound('flap');
                }
            },
            reset() {
                this.y = 150;
                this.speed = 0;
                this.rotation = 0;
            }
        };

        const pipes = {
            position: [],
            top: { image: null },
            bottom: { image: null },
            width: 52,
            height: 320,
            gap: config.pipeGap,
            maxYPosition: -120,
            dx: config.pipeSpeed,

            draw() {
                for (let i = 0; i < this.position.length; i++) {
                    const p = this.position[i];
                    
                    // Top pipe
                    ctx.fillStyle = "#75C54D";
                    ctx.fillRect(p.x, p.y, this.width, this.height);
                    
                    // Pipe cap
                    ctx.fillStyle = "#59A244";
                    ctx.fillRect(p.x - 2, p.y + this.height - 20, this.width + 4, 20);
                    
                    // Bottom pipe
                    ctx.fillStyle = "#75C54D";
                    ctx.fillRect(p.x, p.y + this.height + this.gap, this.width, this.height);
                    
                    // Pipe cap
                    ctx.fillStyle = "#59A244";
                    ctx.fillRect(p.x - 2, p.y + this.height + this.gap, this.width + 4, 20);
                    
       
